---
title: Upgrade to Astro v3
description: How to upgrade your project to the latest version of Astro.
i18nReady: false
---
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'
import FileTree from '~/components/FileTree.astro'


This guide will help you migrate from Astro v2 to Astro v3.

Need to upgrade an older project to v2? See our [older migration guide](/en/guides/upgrade-to/v2/).

## Upgrade Astro

Update your project's version of Astro to the latest version using your package manager. If you're using Astro integrations, please also update those to the latest version.

<PackageManagerTabs>
  <Fragment slot="npm">
  ```shell
  # Upgrade to Astro v3.x
  npm install astro@latest
  
  # Example: upgrade React and Tailwind integrations
  npm install @astrojs/react@latest @astrojs/tailwind@latest
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```shell
  # Upgrade to Astro v3.x
  pnpm install astro@latest

  # Example: upgrade React and Tailwind integrations
  pnpm install @astrojs/react@latest @astrojs/tailwind@latest
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```shell
  # Upgrade to Astro v3.x
  yarn add astro@latest
  
  # Example: upgrade React and Tailwind integrations
  yarn add @astrojs/react@latest @astrojs/tailwind@latest
  ```
  </Fragment>
</PackageManagerTabs>

## Astro v3.0 Breaking Changes

Astro v3.0 includes some breaking changes, as well as the removal of some previously deprecated features. If your project doesn't work as expected after upgrading to v3.0, check this guide for an overview of all breaking changes and instructions on how to update your codebase.

See [the changelog](https://github.com/withastro/astro/blob/main/packages/astro/CHANGELOG.md) for full release notes.

### Removed: Support for Node 16

Node 16 is scheduled to reach its End of Life in September 2023. 

Astro v3.0 drops Node 16 support entirely, so that all Astro users can take advantage of Node's more modern features.

#### What should I do?

 Check that both your development environment and your deployment environment are using **Node `18.14.1` or later**.

1. Check your local version of Node using:

    ```sh
    node -v
    ```

    If your local development environment needs upgrading, [install Node](https://nodejs.org/en/download/).


2. Check your [deployment environment's](/en/guides/deploy/) own documentation to verify that they support Node 18. 

    You can specify Node `18.14.1` for your Astro project either in a dashboard configuration setting, or a `.nvmrc` file.

### Reserved: `src/assets/`

Astro v3.0 now includes the new image services API for optimizing your image assets. This API reserves `src/assets/` as a special folder, with a built-in import alias: `~/assets` for referencing assets located here.

#### What should I do?

No change is required, and there will be no conflicts with an existing `src/assets/` folder. However, you will now have access to the built-in import alias and can choose to rename your asset imports within your files. This folder is not required, and your assets may continued to be located anywhere.

### Changed: automatic flattening of `getStaticPaths()`'s return value

:::note[Example needed]
Find an example of returning an array of an array
:::

In Astro v2.x, we would magically flatten the result of `getStaticPaths()` automatically for the user, so if you returned an array of array, it would still work

Astro v3.0 we changed this in favour of the user doing it themselves when they need to, in line with how we typically prefer for users to do explicit things.

Removed automatic flattening of getStaticPaths result. .flatMap and .flat should now be used to ensure that youâ€™re returning a flat array.

#### What should I do?

If you're returning an array of arrays instead of an array of object (as you should), please flatten it using .flat(), or if you're using a .map(), use .flatMap() instead

A [error message indicating that `getStaticPath()`'s return value must be an array of objects](/en/reference/errors/invalid-get-static-paths-entry/#what-went-wrong) will be provided if you need to update your code.

### Changed: `build.excludeMiddleware` and `build.split` options have been moved to adapter config

In Astro v2.x, `build.excludeMiddleware` and `build.split` could be used to change how specific files were emitted.

Astro v3.0, these build config options have been replaced with new adapter configuruation options.

#### What should I do?

Update the config file to use the option **in the adapter**.

```astro title="astro.mjs.config" del={5-7} ins={9}
import { defineConfig } from "astro/config";
import vercel from "@astrojs/vercel/serverless";

export default defineConfig({
    build: {
      excludeMiddleware: true
    },
    adapter: vercel({
      edgeMiddleware: true
    }),
});
```

```astro title="astro.mjs.config" del={5-7} ins={9}
import { defineConfig } from "astro/config";
import vercel from "@astrojs/vercel/serverless";

export default defineConfig({
     build: {
        split: true
     },
     adapter: vercel({
        functionPerRoute: true
     }),
});
```

```astro title="astro.mjs.config" del={5-7} ins={9}
import { defineConfig } from "astro/config";
import netlify from "@astrojs/netlify/functions";

export default defineConfig({
     build: {
        excludeMiddleware: true
     },
     adapter: netlify({
        edgeMiddleware: true
     }),
});
```

```astro title="astro.mjs.config" del={5-7} ins={9}
import { defineConfig } from "astro/config";
import netlify from "@astrojs/netlify/functions";

export default defineConfig({
     build: {
        split: true
     },
     adapter: netlify({
        functionPerRoute: true
     }),
});
```

### Changed: default image service to Sharp instead of Squoosh

In Astro v2.x, Squoosh was the default image service.

Astro v3.0, Sharp is now the default image service.

#### What should I do?

Sharp is now the default image service used for Astro.

You no longer need to install the dependency locally in your project.

Uninstall Sharp using your package manager, or by removing manually from your `package.json`.

If you would prefer to continue to use Squoosh to transform your images, update your config with the following: 

```ts title="astro.config.mjs" ins={4-6}
import { defineConfig, squooshImageService } from "astro/config";

export default defineConfig({
  image: {
    service: squooshImageService(),
  }
})
```

### Changed: casing in function endpoints 

In Astro v2.x, endpoints were defined using lowercase function names: `get`, `post`, `put`, `all`, and `del`.

Astro v3.0, uses uppercase function names.

#### What should I do?

Rename functions to uppercase equivalent:

- `get` to `GET`
- `post` to `POST`
- `put` to `PUT`
- `all` to `ALL`
- `del` to `DELETE`

:::note[Confirm with Ema]
Does `del` also become `DEL` and / or `DELETE`?

Sarah prefers showing `DEL` only (for consistency)
:::

```ts title="endpoint.ts" del={1} ins={2}
export function get() {
export function GET() {
    return new Response(JSON.stringify({ "title": "Bob's blog" }));
}
```

### Changed: Behaviour when `Astro.cookies.get(key)` doesn't exist

In Astro v2.x, `Astro.cookies.get(key)` would always return a `AstroCookie` object, even if the cookie did not exist. To check for the existence you needed to use `Astro.cookies.has(key)`.

Astro v3.0 `Astro.cookies.get(key)` will return `undefined` if the cookie does not exist.

#### What should I do?

This change will not break existing code that checks for the existance of the `Astro.cookie` object before using `Astro.cookies.get(key)`, but is now no longer required. You can safely remove this code.

You can safely skip `has()` and check if the value is `undefined`:

```ts
// before:
if (Astro.cookies.has(id)) {
  const id = Astro.cookies.get(id)!;
}

//after:
const id = Astro.cookies.get(id);
if (id) {
  // TypeScript knows id is an AstroCookie
}
```

### Changed: the default value of `compressHTML`

In Astro v2.x, Astro only compressed the emitted HTML by explicitly setting the configuration to `true`.

Astro v3.0 now compresses emitted HTML by default.

#### What should I do?

You can now remove `compressHTML: true` from your configuration as this is now the default behavior.

```ts title="astro.config.mjs" del={4}
import { defineConfig } from "astro/config";

export default defineConfig({
	compressHTML: true
})
```

You must now set `compressHTML: false` to opt out of HTML compression.

### Changed: default port used

In Astro v2.x, Astro ran on port `3000` by default.

Astro v3.0 changes the default port to `4321`.

#### What should I do?

Update any existing references to `localhost:3000`, for example in tests or in your `README` to reflect the new port `localhost:4321`.
